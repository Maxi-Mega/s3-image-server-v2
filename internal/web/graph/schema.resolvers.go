package graph

// This file will be automatically regenerated based on the schema, any resolver implementations
// will be copied through when generating and any unknown code will be moved to the end.
// Code generated by github.com/99designs/gqlgen version v0.17.45

import (
	"context"
	"errors"
	"time"

	"github.com/Maxi-Mega/s3-image-server-v2/internal/types"
)

var errInvalidTimeRange = errors.New("invalid time range")

// Objects is the resolver for the Objects field.
func (r *geonamesResolver) Objects(ctx context.Context, obj *types.Geonames) ([]interface{}, error) {
	return toAnySlice(obj.Objects), nil
}

// AdditionalFiles is the resolver for the AdditionalFiles field.
func (r *imageResolver) AdditionalFiles(ctx context.Context, obj *types.Image) (map[string]interface{}, error) {
	return toMapStringAny(obj.AdditionalFiles), nil
}

// TargetFiles is the resolver for the TargetFiles field.
func (r *imageResolver) TargetFiles(ctx context.Context, obj *types.Image) (map[string]interface{}, error) {
	return toMapStringAny(obj.TargetFiles), nil
}

// FullProductFiles is the resolver for the FullProductFiles field.
func (r *imageResolver) FullProductFiles(ctx context.Context, obj *types.Image) (map[string]interface{}, error) {
	return toMapStringAny(obj.FullProductFiles), nil
}

// Corner is the resolver for the Corner field.
func (r *localizationResolver) Corner(ctx context.Context, obj *types.Localization) (interface{}, error) {
	return obj.Corner, nil
}

// GetAllImageSummaries is the resolver for the getAllImageSummaries field.
func (r *queryResolver) GetAllImageSummaries(ctx context.Context, from *time.Time, to *time.Time) (types.AllImageSummaries, error) {
	start := time.Date(0, 1, 1, 0, 0, 0, 0, time.UTC)
	end := time.Now().Add(24 * time.Hour)

	if from != nil {
		start = *from
	}

	if to != nil {
		end = *to
	}

	if start.After(end) {
		return nil, errInvalidTimeRange
	}

	return r.Cache.GetAllImages(start, end), nil
}

// GetImage is the resolver for the getImage field.
func (r *queryResolver) GetImage(ctx context.Context, bucket string, name string) (*types.Image, error) {
	img, err := r.Cache.GetImage(bucket, name)
	if err != nil {
		if errors.Is(err, types.ErrImageNotFound) {
			return nil, nil
		}

		return nil, err
	}

	return &img, nil
}

// Geonames returns GeonamesResolver implementation.
func (r *Resolver) Geonames() GeonamesResolver { return &geonamesResolver{r} }

// Image returns ImageResolver implementation.
func (r *Resolver) Image() ImageResolver { return &imageResolver{r} }

// Localization returns LocalizationResolver implementation.
func (r *Resolver) Localization() LocalizationResolver { return &localizationResolver{r} }

// Query returns QueryResolver implementation.
func (r *Resolver) Query() QueryResolver { return &queryResolver{r} }

type geonamesResolver struct{ *Resolver }
type imageResolver struct{ *Resolver }
type localizationResolver struct{ *Resolver }
type queryResolver struct{ *Resolver }
